@inject IHttpContextAccessor HttpContextAccessor
@using System.Security.Claims
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model CAPSTONE_TEAM01_2024.ViewModels.SemesterReportViewModel
@{
    ViewData["Title"] = " End Semester Report";
    int number = (Model.SemesterReports.PageIndex - 1) * Model.SemesterReports.PageSize;
    var rolesString = HttpContextAccessor.HttpContext.Session.GetString("Roles");
    var roles = rolesString?.Split(',') ?? new string[0];
    bool isNotFaculty = !roles.Contains("BCN Khoa");
    bool isNotAdvisor = !roles.Contains("CVHT");
}

<style>
   
    .list-group-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .list-group-item img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        margin-right: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    

    /* CSS cụ thể cho các modal nhỏ */
    #EditfileModal1_1 .modal-dialog,
    #EditfileModal2_1 .modal-dialog,
    #EditfileModal3_1 .modal-dialog,
    #EditfileModal3_2 .modal-dialog,
    #EditfileModal4_1 .modal-dialog,
    #EditfileModal4_2 .modal-dialog,
    #EditfileModal5_1 .modal-dialog,
    #EditfileModal5_2 .modal-dialog,
    #EditfileModal5_3 .modal-dialog,
    #EditfileModal6_1 .modal-dialog,
    #EditfileModal7_1 .modal-dialog,
    #EditfileModal8_1 .modal-dialog,
    #EditfileModal8_2 .modal-dialog,
    #fileModal1_1 .modal-dialog,
    #fileModal2_1 .modal-dialog,
    #fileModal3_1 .modal-dialog,
    #fileModal3_2 .modal-dialog,
    #fileModal4_1 .modal-dialog,
    #fileModal4_2 .modal-dialog,
    #fileModal5_1 .modal-dialog,
    #fileModal5_2 .modal-dialog,
    #fileModal5_3 .modal-dialog,
    #fileModal6_1 .modal-dialog,
    #fileModal7_1 .modal-dialog,
    #fileModal8_1 .modal-dialog,
    #fileModal8_2 .modal-dialog,
    #EditSemesterReportModal .modal-dialog,
    #SubmitReportModal .modal-dialog,
    #BrowseReportModal .modal-dialog,
    #DeleteReportModal .modal-dialog {
        max-width: 600px; /* Điều chỉnh kích thước nhỏ lại */
    }

    /* Định dạng cho các modal để phân biệt */
    
    #EditSemesterReportModal .modal-header,
    #SubmitReportModal .modal-header,
    #BrowseReportModal .modal-header,
    #DeleteReportModal .modal-header {
        background-color: #f8f9fa; /* Màu nền nhạt */
        border-bottom: 1px solid #ddd;
    }
    /* Phần tử hiển thị thông tin upload */
    .file-info {
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
        padding: 10px;
        cursor: pointer;
        height: 50px;
    }

    /* Danh sách file */
    .file-list {
        list-style-type: none;
        padding: 0;
        margin-top: 10px;
        display: none; /* Ẩn danh sách ban đầu */
    }

    .file-list li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
        padding: 10px;
        margin-bottom: 5px;
    }

    /* Icon xóa */
    .delete-icon {
        cursor: pointer;
        color: red;
        font-size: 16px;
    }

    /* Ensure modal dialog is centered with appropriate width */
    .modal-dialog {
        max-width: 90%;
        width: 100%;
    }

    /* Header section of the modal */
    .modal-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #ddd;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Title styling */
    .modal-title {
        font-size: 18px;
        font-weight: bold;
    }
    

    /* Fields section within the modal */
    .fields-row {
        display: flex;
        width: 100%;
        margin-bottom: 10px;
    }

    /* Styling for header cells in the fields row */
    .header-cell {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 50px;
        font-weight: bold;
        text-align: center;
        border: 1px solid #ddd;
        padding: 0 15px;
        flex-grow: 1;
    }

    /* Styling for text areas */
    textarea {
        resize: none;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 100%;
    }

    /* Make sure file input fields are styled and inline with text areas */
    input[type="file"] {
        padding: 5px;
        margin-top: 5px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

    /* Flex layout for the rows with task descriptions and file inputs */
    .row-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    /* Ensuring each column is aligned and the textarea has a consistent size */
    .row-container > div {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex-basis: 100%;
    }

    textarea[readonly] {
        font-weight: bold;
        background-color: #f8f9fa;
    }

    /* Ensuring button layout */
    .btn {
        padding: 10px 20px;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
        border: none;
    }

    .btn-file {
        background-color: #ff5351;
        color: white;
        border: none;
    }

    /* Hover effect for buttons */
    .btn:hover {
        opacity: 0.9;
    }

    /* Footer section of the modal */
    .modal-footer {
        justify-content: flex-end;
        display: flex;
        width: 100%;
        align-items: center;
        padding-top: 10px;
        border-top: 1px solid #ddd;
    }

</style>

<div class="content-wrapper" style="min-height: 912.2px;">
    <!-- Content Header (Page header) -->
    <header class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h3 class="m-0">Báo Cáo</h3>
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container-fluid -->
    </header>
    <!-- /.content-header -->
    <!-- Main content -->
    <main class="content">
        <div class="container-fluid">
            <div class="card">
                <div class="card-header">
                    <div class="row text-center">
                        @if (isNotFaculty)
                        {
                            <div class="col-auto">
                                <button type="button" class="btn btn-success" onclick="openAddReportModal()">
                                    <i class="bi bi-plus"></i> Thêm Báo Cáo
                                </button>
                            </div>
                        }
                        <div class="col">
                            <nav class="navbar navbar-light bg-light">
                                <form class="d-flex ms-auto">
                                    <input class="form-control me-2" type="search" id="searchInput" placeholder="Nhập nội dung tìm kiếm" aria-label="Search">
                                </form>
                            </nav>
                        </div>
                    </div>
                </div>
                <!-- /.card-header -->
                <div class="card-body">
                    @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success">@TempData["Success"]</div>
                    }
                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger">@TempData["Error"]</div>
                    }
                    @if (TempData["Warning"] != null)
                    {
                        <div class="alert alert-danger">@TempData["Warning"]</div>
                    }
                    <table class="table table-striped" id="data-table">
                        <thead>
                        <tr class="text-center">
                            <th>#</th>
                            <th>Năm Học</th>
                            <th>Loại Báo Cáo</th>
                            <th>Mã Lớp</th>
                            <th>Tên Cố Vấn</th>
                            <th>Ngày Tạo</th>
                            <th>Trạng Thái</th>
                            <th>Thao Tác</th>
                        </tr>
                        </thead>
                        <tbody id="data-table">
                        @foreach (var report in Model.SemesterReports)
                        {
                            number++;
                            <tr>
                                <td class="text-center">@number</td>
                                <td class="text-center">@report.PeriodName</td>
                                <td class="text-center">@report.ReportType</td>
                                <td class="text-center">@report.ClassId</td>
                                <td class="text-center">
                                    @if (report.Class.Advisor != null)
                                    {
                                        @if (string.IsNullOrEmpty(report.Class.Advisor.FullName))
                                        {
                                            @report.Class.Advisor.Email
                                        }
                                        else
                                        { @report.Class.Advisor.FullName
                                        }
                                    }
                                </td>
                                <td class="text-center">@report.CreationTimeReport</td>
                                <td class="text-center">
                                    @if (report.StatusReport == "Nháp")
                                    {
                                        <span class="badge bg-secondary text-white">@report.StatusReport</span>
                                    }
                                    else if (report.StatusReport == "Đã Nộp")
                                    {
                                        <span class="badge bg-success">@report.StatusReport</span>
                                    }
                                    else if (report.StatusReport == "Duyệt")
                                    {
                                        <span class="badge bg-success">@report.StatusReport</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-primary">@report.StatusReport</span>
                                    }
                                </td> 
                                
                                <td class="text-center">

                                    <button class="btn btn-outline-success btn-sm"
                                            title="Xem và Cập Nhật chi tiết"
                                                onclick="openEditDetailModal(@report.ReportId)">
                                        <i class="fa-solid fa-pencil"></i>
                                    </button>
                                    @if (isNotFaculty)
                                    {
                                        <button class="btn btn-outline-primary btn-sm"
                                                title="Cập Nhật"
                                                onclick="openEditSemesterReport(@report.ReportId, @report.PeriodId, '@Html.Raw(report.ReportType)', '@report.ClassId')">
                                            <i class="fa-solid fa-pen-to-square custom-icon"></i>
                                        </button>

                                        <button class="btn btn-outline-danger btn-sm delete"
                                                title="Xóa"
                                                onclick="openDeleteModal(@report.ReportId)">
                                            <i class="fa-solid fa-trash custom-icon"></i>
                                        </button>
                                    }
                                    @if (report.StatusReport == "Nháp" && report.AdvisorName == User.FindFirstValue(ClaimTypes.NameIdentifier))
                                    {
                                            <button class="btn btn-outline-secondary btn-sm"
                                                    title="Nộp"
                                                    onclick="openSubmitSemesterReport(@report.ReportId)">
                                                <i class="fa-solid fa-upload custom-icon"></i>
                                            </button>
                                        
                                    }
                                    @if (isNotFaculty)
                                        {
                                        <form method="post" action="/Categories/DuplicateReport" style="display:inline;">
                                                <input type="hidden" name="reportId" value="@report.ReportId"/>
                                                <button class="btn btn-outline-warning btn-sm duplicate-btn"
                                                        type="submit"
                                                        title="Nhân Bản">
                                                    <i class="bi bi-files"></i>
                                                </button>
                                            </form>
                                        }
                                    
                                    @if (isNotAdvisor)
                                    {
                                        <button class="btn btn-outline-secondary btn-sm"
                                                title="Duyệt"
                                                onclick="openBrowseSemesterReport(@report.ReportId)">
                                            <i class="bi bi-check-circle"></i>
                                        </button>   
                                    }
                                    <form action="/Categories/ExportReport" method="post" style="display: inline;">
                                        <input type="hidden" name="reportId" value="@report.ReportId" />
                                        <button type="submit" class="btn btn-outline-info btn-sm" title="Xuất">
                                            <i class="fa-solid fa-file-export custom-icon"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                             <tr id="noresults" style="display: none;">
                                <td colspan="8" class="text-center">Không tìm thấy nội dung</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Pagination Controls -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-end">
                            @if (Model.SemesterReports.HasPreviousPage)
                            {
                                <li class="page-item">
                                    <a class="page-link" asp-action="SchoolYear" asp-route-pageIndex="@(Model.SemesterReports.PageIndex - 1)" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li class="page-item disabled">
                                    <a class="page-link" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                            }
                            @for (var i = 1; i <= Model.SemesterReports.TotalPages; i++)
                            {
                                if (i == Model.SemesterReports.PageIndex)
                                {
                                    <li class="page-item active">
                                        <a class="page-link">@i</a>
                                    </li>
                                }
                                else
                                {
                                    <li class="page-item">
                                        <a class="page-link" asp-action="SemesterReport" asp-route-pageIndex="@i">@i</a>
                                    </li>
                                }
                            }
                            @if (Model.SemesterReports.HasNextPage)
                            {
                                <li class="page-item">
                                    <a class="page-link" asp-action="SemesterReport" asp-route-pageIndex="@(Model.SemesterReports.PageIndex + 1)" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li class="page-item disabled">
                                    <a class="page-link" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                </div>
                <!-- /.card-body -->
            </div>
        </div>
    </main>
</div>

<!--Add Modal--> 
<div class="modal fade" id="AddReportModal" tabindex="-1" aria-labelledby="AddReportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                <h5 class="modal-title" id="AddSemesterReportModalLabel">Thêm Báo Cáo Cuối Kỳ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addReportForm" method="post" action="/Categories/AddReport" enctype="multipart/form-data">
                <!-- Dropdown Options -->
                <div class="fields-row" style="display: flex; align-items: center; gap: 10px; width: 100%; font-weight: bold; padding-bottom: 5px;">
                    <div style="flex: 1; text-align: center;">Báo Cáo CVHT </div>
                    <input type="hidden" id="ReportType" name="ReportType" value="Báo Cáo CVHT" />
                    <div style="flex: 1; text-align: center;">
                        <select id="PeriodId" name="PeriodId" style="width: 100%;" required>
                            <option value="" disabled selected>Vui lòng chọn năm học</option>
                            @foreach (var item in Model.SchoolYears)
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        </select>
                    </div>
                    <div style="flex: 1; text-align: center;">Lớp: </div>
                    <div style="flex: 1; text-align: center;">
                        <select id="ClassId" name="ClassId" style="width: 100%;" required>
                            <option value="" disabled selected>Vui lòng chọn lớp</option>
                            @foreach (var item in Model.Class)
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        </select>
                    </div>
                </div>
                <!-- Header Row for Fields -->
                <div class="fields-row" style="display: flex; align-items: center; height: 50px;">
                    <div class="header-cell" style="flex: 1.05; text-align: center;">Tiêu Chí Đánh Giá</div>
                    <div class="header-cell" style="flex: 1; text-align: center;">Mô Tả Công Việc Cụ Thể</div>
                    <div class="header-cell" style="flex: 1; text-align: center;">Hồ Sơ, Minh Chứng</div>
                </div>
                <!-- Rows for Tiêu Chí 1 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria1" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>1.Có kế hoạch hoạt động về công tác CVHT của năm học.</textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task1_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>Kế hoạch cụ thể, rõ ràng, nộp đúng hạn. Hoạt động diễn ra trong học kỳ, năm học đáp ứng bao nhiêu % kế hoạch thiết kế.</textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute1_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList1_1" name="files1_1[]" multiple id="uploadField1_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField1_1')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 2 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria2" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>2.CVHT khai thác hệ thống quản lý học tập của SV để nắm rõ tình trạng học tập của SV </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task2_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>CVHT sử dụng thành thạo tài khoản online đã được phân quyền để khai thác hiệu quả và đánh giá được kết quả học tập của SV đối với lớp do mình làm cố vấn. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute2_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList2_1" name="files2_1[]" multiple id=" uploadField2_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField2_1')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 3 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria3" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>3.Tổ chức các cuộc họp lớp, tư vấn cho sinh viên các nội dung học tập như: quy chế, quy định về tổ chức hoạt động đào tạo theo học chế tín chỉ; cấu trúc, lưu đồ của CTĐT, mục tiêu đào tạo, chuẩn đầu ra của ngành/chuyên ngành… </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task3_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>3.1.CVHT thu thập và hiểu các văn bản liên quan quy định, quy chế đào tạo, chuẩn đầu ra, cấu trúc, lưu đồ CTĐT…phổ biến nội dung trong các buổi sinh hoạt lớp và tư vấn trực tiếp cho SV khi cần. Tổ chức sinh hoạt lớp SV bằng hình thức trực tiếp hoặc trực tuyến (online) ít nhất 2 lần/học kỳ; có biên bản các cuộc họp đầy đủ, đáp ứng yêu cầu về nội dung họp. </textarea>
                        <textarea name="Task3_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>3.2.Tiếp SV trực tiếp theo lịch trực tại văn phòng khoa hoặc thông qua các phương tiện khác. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute3_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList3_1" name="files3_1[]" multiple id="uploadField3_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField3_1')">
                            Xem danh sách file đã upload
                        </button>

                        <textarea name="HowToExecute3_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList3_2" name="files3_2[]" multiple id="uploadField3_2">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField3_2')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 4 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria4" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>4.Tổ chức các cuộc họp lớp, tư vấn cho sinh viên các nội dung học tập như: quy chế, quy định về tổ chức hoạt động đào tạo theo học chế tín chỉ; cấu trúc, lưu đồ của CTĐT, mục tiêu đào tạo, chuẩn đầu ra của ngành/chuyên ngành… </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task4_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>4.1.Hướng dẫn sinh viên cách xây dựng kế hoạch học tập cho khóa học hoặc năm học, tư vấn cho sinh viên lập kế hoạch học tập của năm học hoặc khóa học, xem xét và phê duyệt kế hoạch học tập của sinh viên đối với những trường hợp có yêu cầu từ Phòng Đào tạo.  </textarea>
                        <textarea name="Task4_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>4.2.Hướng dẫn sinh viên điều chỉnh kế hoạch học tập và đăng ký môn học phù hợp với năng lực và hoàn cảnh của từng sinh viên.  </textarea>

                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute4_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList4_1" name="files4_1[]" multiple id="uploadField4_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField4_1')">
                            Xem danh sách file đã upload
                        </button>

                        <textarea name="HowToExecute4_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList4_2" name="files4_2[]" multiple id="uploadField4_2">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField4_2')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 5 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria5" style="flex: 1; min-width: 100px; height: 550px; font-weight: bold;" readonly>5.Trao đổi kinh nghiệm cá nhân trong học tập và nghề nghiệp, định hướng nghề nghiệp cho SV có nhu cầu. Tư vấn cho SV lựa chọn chuyên ngành (nếu có).</textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task5_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.1.Tư vấn sinh viên lựa chọn chuyên ngành  

Nếu khoa có chia chuyên ngành, CVHT tư vấn SV lựa chọn phù hợp với sở thích, năng lực của SV, dựa trên cơ sở cung cấp đầy đủ thông tin đào tạo của chuyên ngành. </textarea>
                        <textarea name="Task5_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.2.Trao đổi kinh nghiệm cá nhân trong học tập và nghề nghiệp, định hướng nghề nghiệp cho sinh viên có nhu cầu.</textarea>
                        <textarea name="Task5_3" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.3.Giới thiệu nơi thực tập và việc làm cho SV (nếu có).</textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute5_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList5_1" name="files5_1[]" multiple id="uploadField5_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField5_1')">
                            Xem danh sách file đã upload
                        </button>

                        <textarea name="HowToExecute5_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList5_2" name="files5_2[]" multiple id="uploadField5_2">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" 
                        data-bs-target="#fileListModal" onclick="showFileList('uploadField5_2')">
                            Xem danh sách file đã upload
                        </button>

                        <!-- 5_3 -->
                        <textarea name="HowToExecute5_3" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList5_3" name="files5_3[]" multiple id="uploadField5_3">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField5_3')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 6 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria6" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>6.Tư vấn SV thuộc diện cảnh báo học vụ (Quy trình cảnh báo sớm). </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task6_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>Tư vấn sinh viên thuộc diện cảnh báo học vụ hoặc có nguy cơ bị cảnh báo học vụ ở từng học kỳ có phương án học tập tiếp theo. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute6_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList6_1" name="files6_1[]" multiple id="uploadField6_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField6_1')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 7 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria7" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>7.Các ý kiến, đề xuất, khiếu nại của SV được phản ánh kịp thời đến các cấp có thẩm quyền.  </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task7_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>CVHT làm cầu nối giữa SV và Khoa, Trường trong đề đạt nguyện vọng, ý kiến, phản ánh nhằm xây dựng môi trường học tập lành mạnh. Không có trường hợp SV gửi đơn thư khiếu nại vượt cấp. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="HowToExecute7_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList7_1" name="files7_1[]" multiple>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" onclick="showFileList(7, 1)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 8 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria8" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>8.Tham gia đầy đủ các buổi tập huấn/hội nghị/cuộc họp liên quan đến công tác CVHT do Khoa, Trường tổ chức (nếu có).</textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task8_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>8.1.Tham dự họp, hội nghị theo triệu tập của của các cấp: Khoa - Phòng chức năng - Trường.</textarea>
                        <textarea name="Task8_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>8.2.Tham gia họp tổng kết, đánh giá công tác CVHT do Hội đồng Khoa triệu tập. </textarea>

                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <!-- 8_1 -->
                        <textarea name="HowToExecute8_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList8_1" name="files8_1[]" multiple id="uploadField8_1">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                data-bs-target="#fileListModal" onclick="showFileList('uploadField8_1')">
                            Xem danh sách file đã upload
                        </button>
                        <!-- 8_2 -->
                        <textarea name="HowToExecute8_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                        <!-- Input file -->
                        <input type="file" class="upload-file" data-target="fileList8_2" name="files8_2[]" multiple id="uploadField8_2">
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal"
                                 data-bs-target="#fileListModal" onclick="showFileList('uploadField8_2')">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!--CVHT Danh Gia-->
                <div style="display: flex; flex-direction: row; gap: 10px; margin-bottom: 20px;margin-top: 20px;margin-left: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="selfAssessment" style="white-space: nowrap; font-weight: bold;">Cá Nhân Tự Đánh Giá:</label>
                        <textarea id="selfAssessment" name="selfAssessment"
                                      placeholder="Nhập đánh giá"
                                      style="flex: 1; width: 850px; height: 50px;overflow-y: auto; "></textarea>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="ranking" style="white-space: nowrap; font-weight: bold;">Cá Nhân Tự Xếp Loại:</label>
                        <select id="ranking" name="selfRanking"
                                style="width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; margin-left: 20px;">
                            @if (isNotFaculty)
                            {
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            }
                        </select>
                    </div>
                </div>

                <!--BCN Khoa Danh Gia-->
               
                    <div style="display: flex; flex-direction: row; gap: 10px; margin-bottom: 20px;  margin-left: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label for="FaculityAssessment" style="white-space: nowrap; font-weight: bold;">BCN Khoa Đánh Giá:</label>
                            <textarea id="FaculityAssessment" name="FaculityAssessment"
                                      placeholder="Nhập đánh giá"
                                      style="flex: 1; width: 850px; height: 50px;overflow-y: auto;margin-left: 13px; " readonly></textarea>

                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;margin-left: 10px;">
                            <label for="ranking" style="white-space: nowrap; font-weight: bold;">BCN Khoa Xếp Loại:</label>
                            <!-- Combo box -->
                            <select id="Faculityranking" name="Faculityranking"
                                    style="width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; margin-left: 20px;">
                                @if (isNotAdvisor)
                                {
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                }
                            </select>
                        </div>
                    </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer" style="display: flex; justify-content: flex-end; width: 100%; align-items: center;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button> <!-- Submit button to send the form -->
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Submit Report Modal -->
<div class="modal fade" id="SubmitReportModal" tabindex="-1" aria-labelledby="SubmitSemesterReportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="SubmitReportModalLabel">Nộp Báo Cáo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn nộp Báo Cáo này không?</p>
                <form id="submitReportForm" asp-action="SubmitReport" method="post">
                    <input type="hidden" id="SubmitReportId" name="ReportId" />
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-danger">Nộp</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Browse Report Modal -->
<div class="modal fade" id="BrowseReportModal" tabindex="-1" aria-labelledby="BrowseSemesterReportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="BrowseReportModalLabel">Duyệt Báo Cáo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn Duyệt Báo Cáo này không?</p>
                <form id="BrowseReportForm" asp-action="BrowseReport" method="post">
                    <input type="hidden" id="BrowseReportId" name="ReportId" />
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="browse" class="btn btn-danger">Duyệt</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Report Modal -->
<div class="modal fade" id="EditSemesterReportModal" tabindex="-1" aria-labelledby="EditSemesterReportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" >
                <h5 class="modal-title" id="EditSemesterReportModalLabel">Chỉnh sửa Báo Cáo Cuối Kỳ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="EditSemesterReportForm" method="post" action="/Categories/EditReport">
                <div class="modal-body" style="overflow-y: auto; max-height: 80vh;">
                    <div class="mb-3">
                        <input type="hidden" id="EditReportId" name="ReportId" class="form-control" required>
                        <label for="EditPeriodId" class="form-label">Năm Học</label>
                        <select class="form-select" id="EditPeriodId" name="PeriodId" class="form-control" required>
                            @foreach (var item in Model.SchoolYears)
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="EditReportType" class="form-label">Loại Báo Cáo</label>
                        <input type="text" id="EditReportType" name="reportType" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="EditClassId" class="form-label">Mã Lớp</label>
                        <select class="form-select" id="EditClassId" name="ClassId" class="form-control" required>
                            @foreach (var item in Model.Class)
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer" style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary save">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Detail Modal for BCN Khoa -->
@if (isNotAdvisor)
{
    <div class="modal fade" id="EditReportDetailModal" tabindex="-1" aria-labelledby="EditSemesterReportDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header" style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                <h5 class="modal-title" id="EditSemesterReportDetailModalLabel">Chi Tiết Báo Cáo Học Kỳ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Form -->
            <form id="editSemesterReportForm" method="post" action="/Categories/EditReportDetail" enctype="multipart/form-data">
                <!-- Dropdown Options for Period and Class -->
                <div class="fields-row" style="display: flex; align-items: center; gap: 10px; width: 100%; font-weight: bold; padding-bottom: 5px;">
                    <input type = "hidden" id="DetailIds" name="ReportId"/>
                </div>
                <!-- Header Row for Fields -->
                <div class="fields-row" style="display: flex; align-items: center; height: 50px;">
                    <div class="header-cell" style="flex: 1.05; text-align: center;">Tiêu Chí Đánh Giá</div>
                    <div class="header-cell" style="flex: 1; text-align: center;">Mô Tả Công Việc Cụ Thể</div>
                    <div class="header-cell" style="flex: 1; text-align: center;">Hồ Sơ, Minh Chứng</div>
                </div>
                <!-- Rows for Tiêu Chí 1 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria1" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>1.Có kế hoạch hoạt động về công tác CVHT của năm học.</textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task1_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>Kế hoạch cụ thể, rõ ràng, nộp đúng hạn. Hoạt động diễn ra trong học kỳ, năm học đáp ứng bao nhiêu % kế hoạch thiết kế.</textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute1_1" name="HowToExecute1_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly=""></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList1_1" id="Editfiles1_1[]" name="files1_1[]" multiple disabled>
                        <!-- Button with dynamic detailId -->
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail0" data-detail-id="" data-files="Editfiles1_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 2 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria2" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>2.CVHT khai thác hệ thống quản lý học tập của SV để nắm rõ tình trạng học tập của SV </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task2_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>CVHT sử dụng thành thạo tài khoản online đã được phân quyền để khai thác hiệu quả và đánh giá được kết quả học tập của SV đối với lớp do mình làm cố vấn. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute2_1" name="HowToExecute2_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList2_1" id="Editfiles2_1[]" name="files2_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail1" data-detail-id="" data-files="Editfiles2_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 3 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria3" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>3.Tổ chức các cuộc họp lớp, tư vấn cho sinh viên các nội dung học tập như: quy chế, quy định về tổ chức hoạt động đào tạo theo học chế tín chỉ; cấu trúc, lưu đồ của CTĐT, mục tiêu đào tạo, chuẩn đầu ra của ngành/chuyên ngành… </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task3_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>3.1.CVHT thu thập và hiểu các văn bản liên quan quy định, quy chế đào tạo, chuẩn đầu ra, cấu trúc, lưu đồ CTĐT…phổ biến nội dung trong các buổi sinh hoạt lớp và tư vấn trực tiếp cho SV khi cần. Tổ chức sinh hoạt lớp SV bằng hình thức trực tiếp hoặc trực tuyến (online) ít nhất 2 lần/học kỳ; có biên bản các cuộc họp đầy đủ, đáp ứng yêu cầu về nội dung họp. </textarea>
                        <textarea name="Task3_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>3.2.Tiếp SV trực tiếp theo lịch trực tại văn phòng khoa hoặc thông qua các phương tiện khác. </textarea>

                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute3_1" name="HowToExecute3_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly ></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList3_1" id="Editfiles3_1[]" name="files3_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail2" data-detail-id="" data-files="Editfiles3_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                        <textarea id="EditHowToExecute3_2" name="HowToExecute3_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList3_2" id="Editfiles3_2[]" name="files3_2[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail3" data-detail-id="" data-files="Editfiles3_2[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 4 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria4" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>4.Tổ chức các cuộc họp lớp, tư vấn cho sinh viên các nội dung học tập như: quy chế, quy định về tổ chức hoạt động đào tạo theo học chế tín chỉ; cấu trúc, lưu đồ của CTĐT, mục tiêu đào tạo, chuẩn đầu ra của ngành/chuyên ngành… </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task4_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>4.1.Hướng dẫn sinh viên cách xây dựng kế hoạch học tập cho khóa học hoặc năm học, tư vấn cho sinh viên lập kế hoạch học tập của năm học hoặc khóa học, xem xét và phê duyệt kế hoạch học tập của sinh viên đối với những trường hợp có yêu cầu từ Phòng Đào tạo.  </textarea>
                        <textarea name="Task4_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>4.2.Hướng dẫn sinh viên điều chỉnh kế hoạch học tập và đăng ký môn học phù hợp với năng lực và hoàn cảnh của từng sinh viên.  </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute4_1" name="HowToExecute4_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList4_1" id="Editfiles4_1[]" name="files4_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail4" data-detail-id="" data-files="Editfiles4_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                        <textarea id="EditHowToExecute4_2" name="HowToExecute4_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList4_2" id="Editfiles4_2[]" name="files4_2[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail5" data-detail-id="" data-files="Editfiles4_2[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 5 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria5" style="flex: 1; min-width: 100px; height: 550px; font-weight: bold;" readonly>5.Trao đổi kinh nghiệm cá nhân trong học tập và nghề nghiệp, định hướng nghề nghiệp cho SV có nhu cầu. Tư vấn cho SV lựa chọn chuyên ngành (nếu có).</textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task5_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.1.Tư vấn sinh viên lựa chọn chuyên ngành  

Nếu khoa có chia chuyên ngành, CVHT tư vấn SV lựa chọn phù hợp với sở thích, năng lực của SV, dựa trên cơ sở cung cấp đầy đủ thông tin đào tạo của chuyên ngành. </textarea>
                        <textarea name="Task5_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.2.Trao đổi kinh nghiệm cá nhân trong học tập và nghề nghiệp, định hướng nghề nghiệp cho sinh viên có nhu cầu.</textarea>
                        <textarea name="Task5_3" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.3.Giới thiệu nơi thực tập và việc làm cho SV (nếu có).</textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute5_1" name="HowToExecute5_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList5_1" id="Editfiles5_1[]" name="files5_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail6" data-detail-id="" data-files="Editfiles5_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                        <textarea id="EditHowToExecute5_2" name="HowToExecute5_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList5_2" id="Editfiles5_2[]" name="files5_2[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail7" data-detail-id="" data-files="Editfiles5_2[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                        <!-- 5_3 -->
                        <textarea id="EditHowToExecute5_3" name="HowToExecute5_3" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList5_3" id="Editfiles5_3[]" name="files5_3[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail8" data-detail-id="" data-files="Editfiles5_3[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                    </div>
                </div>
                <!-- Rows for Tiêu Chí 6 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria6" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>6.Tư vấn SV thuộc diện cảnh báo học vụ (Quy trình cảnh báo sớm). </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task6_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>Tư vấn sinh viên thuộc diện cảnh báo học vụ hoặc có nguy cơ bị cảnh báo học vụ ở từng học kỳ có phương án học tập tiếp theo. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute6_1"  name="HowToExecute6_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList6_1" id="Editfiles6_1[]" name="files6_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail9" data-detail-id="" data-files="Editfiles6_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 7 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria7" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>7.Các ý kiến, đề xuất, khiếu nại của SV được phản ánh kịp thời đến các cấp có thẩm quyền.  </textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task7_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>CVHT làm cầu nối giữa SV và Khoa, Trường trong đề đạt nguyện vọng, ý kiến, phản ánh nhằm xây dựng môi trường học tập lành mạnh. Không có trường hợp SV gửi đơn thư khiếu nại vượt cấp. </textarea>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="EditHowToExecute7_1" name="HowToExecute7_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList7_1" id="Editfiles7_1[]" name="files7_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail10" data-detail-id="" data-files="Editfiles7_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>
                    </div>
                </div>
                <!-- Rows for Tiêu Chí 8 -->
                <div style="display: flex; width: 100%;">
                    <textarea name="Criteria8" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>8.Tham gia đầy đủ các buổi tập huấn/hội nghị/cuộc họp liên quan đến công tác CVHT do Khoa, Trường tổ chức (nếu có).</textarea>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task8_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>8.1.Tham dự họp, hội nghị theo triệu tập của của các cấp: Khoa - Phòng chức năng - Trường.</textarea>
                        <textarea name="Task8_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>8.2.Tham gia họp tổng kết, đánh giá công tác CVHT do Hội đồng Khoa triệu tập. </textarea>

                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <!-- 8_1 -->
                        <textarea id="EditHowToExecute8_1" name="HowToExecute8_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList8_1" id="Editfiles8_1[]" name="files8_1[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail11" data-detail-id="" data-files="Editfiles8_1[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                        <!-- 8_2 -->
                        <textarea id="EditHowToExecute8_2" name="HowToExecute8_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;" readonly></textarea>
                        <!-- Input file -->
                        <input type="file" class="Edit-upload-file" data-target="EditfileList8_2" id="Editfiles8_2[]" name="files8_2[]" multiple disabled>
                        <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                id="buttonForDetail12" data-detail-id="" data-files="Editfiles8_2[]" onclick="fetchAttachmentsFromButton(this)">
                            Xem danh sách file đã upload
                        </button>

                    </div>
                </div>
                <!--CVHT Danh Gia-->
                
                    <div style="display: flex; flex-direction: row; gap: 10px; margin-bottom: 20px;margin-top: 20px;margin-left: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label for="selfAssessment" style="white-space: nowrap; font-weight: bold;">Cá Nhân Tự Đánh Giá:</label>
                            <textarea id="EditselfAssessment" name="EditselfAssessment"
                                  placeholder="Nhập đánh giá"
                                  style="flex: 1; width: 850px; height: 50px;overflow-y: auto; " readonly></textarea>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label for="ranking" style="white-space: nowrap; font-weight: bold;">Cá Nhân Tự Xếp Loại:</label>
                            <select id="Editranking" name="Editranking"
                                    style="width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; margin-left: 20px; pointer-events: none">
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option> 
                            </select>
                        </div>
                    </div>
                
                <!--BCN Khoa Danh Gia-->
                <div style="display: flex; flex-direction: row; gap: 10px; margin-bottom: 20px;  margin-left: 10px;">

                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="FaculityAssessment" style="white-space: nowrap; font-weight: bold;">BCN Khoa Đánh Giá:</label>
                        <textarea id="EditFaculityAssessment" name="EditFaculityAssessment"
                                  placeholder="Nhập đánh giá"
                                  style="flex: 1; width: 850px; height: 50px;overflow-y: auto;margin-left: 13px; "></textarea>

                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;margin-left: 10px;">
                        <label for="ranking" style="white-space: nowrap; font-weight: bold;">BCN Khoa Xếp Loại:</label>
                        <!-- Combo box -->
                        <select id="EditFaculityranking" name="EditFaculityranking"
                                style="width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; margin-left: 20px;">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                </div>
                    <!-- Modal Footer -->
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; width: 100%; align-items: center;">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button> <!-- Submit button to send the form -->
                    </div>

                </form>
            </div>
        </div>
    </div>
}

<!-- Edit Detail Modal for CVHT -->
@if (isNotFaculty)
{
    <div class="modal fade" id="EditReportDetailModal" tabindex="-1" aria-labelledby="EditSemesterReportDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header" style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                    <h5 class="modal-title" id="EditSemesterReportDetailModalLabel">Chi Tiết Báo Cáo Học Kỳ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Modal Form -->
                <form id="editSemesterReportForm" method="post" action="/Categories/EditReportDetail" enctype="multipart/form-data">
                    <!-- Dropdown Options for Period and Class -->
                    <div class="fields-row" style="display: flex; align-items: center; gap: 10px; width: 100%; font-weight: bold; padding-bottom: 5px;">
                        <input type = "hidden" id="DetailIds" name="ReportId"/>
                    </div>
                    <!-- Header Row for Fields -->
                    <div class="fields-row" style="display: flex; align-items: center; height: 50px;">
                        <div class="header-cell" style="flex: 1.05; text-align: center;">Tiêu Chí Đánh Giá</div>
                        <div class="header-cell" style="flex: 1; text-align: center;">Mô Tả Công Việc Cụ Thể</div>
                        <div class="header-cell" style="flex: 1; text-align: center;">Hồ Sơ, Minh Chứng</div>
                    </div>
                    <!-- Rows for Tiêu Chí 1 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria1" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>1.Có kế hoạch hoạt động về công tác CVHT của năm học.</textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task1_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>Kế hoạch cụ thể, rõ ràng, nộp đúng hạn. Hoạt động diễn ra trong học kỳ, năm học đáp ứng bao nhiêu % kế hoạch thiết kế.</textarea>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute1_1" name="HowToExecute1_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList1_1" id="Editfiles1_1[]" name="files1_1[]" multiple>
                            <!-- Button with dynamic detailId -->
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail0" data-detail-id="" data-files="Editfiles1_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>
                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 2 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria2" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>2.CVHT khai thác hệ thống quản lý học tập của SV để nắm rõ tình trạng học tập của SV </textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task2_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>CVHT sử dụng thành thạo tài khoản online đã được phân quyền để khai thác hiệu quả và đánh giá được kết quả học tập của SV đối với lớp do mình làm cố vấn. </textarea>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute2_1" name="HowToExecute2_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList2_1" id="Editfiles2_1[]" name="files2_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail1" data-detail-id="" data-files="Editfiles2_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>
                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 3 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria3" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>3.Tổ chức các cuộc họp lớp, tư vấn cho sinh viên các nội dung học tập như: quy chế, quy định về tổ chức hoạt động đào tạo theo học chế tín chỉ; cấu trúc, lưu đồ của CTĐT, mục tiêu đào tạo, chuẩn đầu ra của ngành/chuyên ngành… </textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task3_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>3.1.CVHT thu thập và hiểu các văn bản liên quan quy định, quy chế đào tạo, chuẩn đầu ra, cấu trúc, lưu đồ CTĐT…phổ biến nội dung trong các buổi sinh hoạt lớp và tư vấn trực tiếp cho SV khi cần. Tổ chức sinh hoạt lớp SV bằng hình thức trực tiếp hoặc trực tuyến (online) ít nhất 2 lần/học kỳ; có biên bản các cuộc họp đầy đủ, đáp ứng yêu cầu về nội dung họp. </textarea>
                            <textarea name="Task3_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>3.2.Tiếp SV trực tiếp theo lịch trực tại văn phòng khoa hoặc thông qua các phương tiện khác. </textarea>

                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute3_1" name="HowToExecute3_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList3_1" id="Editfiles3_1[]" name="files3_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail2" data-detail-id="" data-files="Editfiles3_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                            <textarea id="EditHowToExecute3_2" name="HowToExecute3_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList3_2" id="Editfiles3_2[]" name="files3_2[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail3" data-detail-id="" data-files="Editfiles3_2[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>
                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 4 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria4" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>4.Tổ chức các cuộc họp lớp, tư vấn cho sinh viên các nội dung học tập như: quy chế, quy định về tổ chức hoạt động đào tạo theo học chế tín chỉ; cấu trúc, lưu đồ của CTĐT, mục tiêu đào tạo, chuẩn đầu ra của ngành/chuyên ngành… </textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task4_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>4.1.Hướng dẫn sinh viên cách xây dựng kế hoạch học tập cho khóa học hoặc năm học, tư vấn cho sinh viên lập kế hoạch học tập của năm học hoặc khóa học, xem xét và phê duyệt kế hoạch học tập của sinh viên đối với những trường hợp có yêu cầu từ Phòng Đào tạo.  </textarea>
                            <textarea name="Task4_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>4.2.Hướng dẫn sinh viên điều chỉnh kế hoạch học tập và đăng ký môn học phù hợp với năng lực và hoàn cảnh của từng sinh viên.  </textarea>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute4_1" name="HowToExecute4_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList4_1" id="Editfiles4_1[]" name="files4_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail4" data-detail-id="" data-files="Editfiles4_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                            <textarea id="EditHowToExecute4_2" name="HowToExecute4_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList4_2" id="Editfiles4_2[]" name="files4_2[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail5" data-detail-id="" data-files="Editfiles4_2[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>
                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 5 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria5" style="flex: 1; min-width: 100px; height: 550px; font-weight: bold;" readonly>5.Trao đổi kinh nghiệm cá nhân trong học tập và nghề nghiệp, định hướng nghề nghiệp cho SV có nhu cầu. Tư vấn cho SV lựa chọn chuyên ngành (nếu có).</textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                        <textarea name="Task5_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.1.Tư vấn sinh viên lựa chọn chuyên ngành  

Nếu khoa có chia chuyên ngành, CVHT tư vấn SV lựa chọn phù hợp với sở thích, năng lực của SV, dựa trên cơ sở cung cấp đầy đủ thông tin đào tạo của chuyên ngành. </textarea>
                            <textarea name="Task5_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.2.Trao đổi kinh nghiệm cá nhân trong học tập và nghề nghiệp, định hướng nghề nghiệp cho sinh viên có nhu cầu.</textarea>
                            <textarea name="Task5_3" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>5.3.Giới thiệu nơi thực tập và việc làm cho SV (nếu có).</textarea>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute5_1" name="HowToExecute5_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList5_1" id="Editfiles5_1[]" name="files5_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail6" data-detail-id="" data-files="Editfiles5_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                            <textarea id="EditHowToExecute5_2" name="HowToExecute5_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList5_2" id="Editfiles5_2[]" name="files5_2[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail7" data-detail-id="" data-files="Editfiles5_2[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                            <!-- 5_3 -->
                            <textarea id="EditHowToExecute5_3" name="HowToExecute5_3" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList5_3" id="Editfiles5_3[]" name="files5_3[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail8" data-detail-id="" data-files="Editfiles5_3[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 6 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria6" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>6.Tư vấn SV thuộc diện cảnh báo học vụ (Quy trình cảnh báo sớm). </textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task6_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>Tư vấn sinh viên thuộc diện cảnh báo học vụ hoặc có nguy cơ bị cảnh báo học vụ ở từng học kỳ có phương án học tập tiếp theo. </textarea>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute6_1"  name="HowToExecute6_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList6_1" id="Editfiles6_1[]" name="files6_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail9" data-detail-id="" data-files="Editfiles6_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>
                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 7 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria7" style="flex: 1; min-width: 100px; height: 200px; font-weight: bold;" readonly>7.Các ý kiến, đề xuất, khiếu nại của SV được phản ánh kịp thời đến các cấp có thẩm quyền.  </textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task7_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>CVHT làm cầu nối giữa SV và Khoa, Trường trong đề đạt nguyện vọng, ý kiến, phản ánh nhằm xây dựng môi trường học tập lành mạnh. Không có trường hợp SV gửi đơn thư khiếu nại vượt cấp. </textarea>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="EditHowToExecute7_1" name="HowToExecute7_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList7_1" id="Editfiles7_1[]" name="files7_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail10" data-detail-id="" data-files="Editfiles7_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>
                        </div>
                    </div>
                    <!-- Rows for Tiêu Chí 8 -->
                    <div style="display: flex; width: 100%;">
                        <textarea name="Criteria8" style="flex: 1; min-width: 100px; height: 360px; font-weight: bold;" readonly>8.Tham gia đầy đủ các buổi tập huấn/hội nghị/cuộc họp liên quan đến công tác CVHT do Khoa, Trường tổ chức (nếu có).</textarea>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea name="Task8_1" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>8.1.Tham dự họp, hội nghị theo triệu tập của của các cấp: Khoa - Phòng chức năng - Trường.</textarea>
                            <textarea name="Task8_2" style="flex: 1; min-width: 100px; height: 50px; font-weight: bold;" readonly>8.2.Tham gia họp tổng kết, đánh giá công tác CVHT do Hội đồng Khoa triệu tập. </textarea>

                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <!-- 8_1 -->
                            <textarea id="EditHowToExecute8_1" name="HowToExecute8_1" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList8_1" id="Editfiles8_1[]" name="files8_1[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail11" data-detail-id="" data-files="Editfiles8_1[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                            <!-- 8_2 -->
                            <textarea id="EditHowToExecute8_2" name="HowToExecute8_2" style="flex: 1; min-width: 100px; height: 50px;overflow-y: auto;"></textarea>
                            <!-- Input file -->
                            <input type="file" class="Edit-upload-file" data-target="EditfileList8_2" id="Editfiles8_2[]" name="files8_2[]" multiple>
                            <button type="button" class="btn btn-file mt-1" data-bs-toggle="modal" data-bs-target="#fileListModal"
                                    id="buttonForDetail12" data-detail-id="" data-files="Editfiles8_2[]" onclick="fetchAttachmentsFromButton(this)">
                                Xem danh sách file đã upload
                            </button>

                        </div>
                    </div>
                    <!--CVHT Danh Gia-->

                    <div style="display: flex; flex-direction: row; gap: 10px; margin-bottom: 20px;margin-top: 20px;margin-left: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label for="selfAssessment" style="white-space: nowrap; font-weight: bold;">Cá Nhân Tự Đánh Giá:</label>
                            <textarea id="EditselfAssessment" name="EditselfAssessment"
                                      placeholder="Nhập đánh giá"
                                      style="flex: 1; width: 850px; height: 50px;overflow-y: auto; "></textarea>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label for="ranking" style="white-space: nowrap; font-weight: bold;">Cá Nhân Tự Xếp Loại:</label>
                            <select id="Editranking" name="Editranking"
                                    style="width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; margin-left: 20px;">
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                    </div>

                    <!--BCN Khoa Danh Gia-->
                    <div style="display: flex; flex-direction: row; gap: 10px; margin-bottom: 20px;  margin-left: 10px;">

                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label for="FaculityAssessment" style="white-space: nowrap; font-weight: bold;">BCN Khoa Đánh Giá:</label>
                            <textarea id="EditFaculityAssessment" name="EditFaculityAssessment"
                                      placeholder="Nhập đánh giá"
                                      style="flex: 1; width: 850px; height: 50px;overflow-y: auto;margin-left: 13px;" readonly=""></textarea>

                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;margin-left: 10px;">
                            <label for="ranking" style="white-space: nowrap; font-weight: bold;">BCN Khoa Xếp Loại:</label>
                            <!-- Combo box -->
                            <select id="EditFaculityranking" name="EditFaculityranking"
                                    style="width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; margin-left: 20px; pointer-events: none">
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                    </div>
                    <!-- Modal Footer -->
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; width: 100%; align-items: center;">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button> <!-- Submit button to send the form -->
                    </div>

                </form>
            </div>
        </div>
    </div>
}

<!-- Delete Report Modal -->
<div class="modal fade" id="DeleteReportModal" tabindex="-1" aria-labelledby="DeleteSemesterReportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DeleteReportModalLabel">Xóa Báo Cáo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa Báo Cáo này không?</p>
                <form id="deletePlanForm" asp-action="DeleteReport" method="post">
                    <input type="hidden" id="DeleteReportId" name="ReportId" />
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-danger">Xóa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--File List Modal-->
<div class="modal fade" id="fileListModal" tabindex="-1" aria-labelledby="fileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h5 class="modal-title" id="fileModalLabel">Danh sách file đã upload</h5>
                    <p class="modal-title" style="margin-top: 10px; font-weight: bold; color: red;">Thầy/Cô nhớ lưu Báo Cáo, nếu không sẽ mất các minh chứng đã upload.</p>
                    </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="fileList" class="list-group">
                    <!-- Uploaded files will be displayed here -->
                </ul>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
        </div>
    </div>
</div>

<script>
// Search JS
    document.getElementById('searchInput').addEventListener('input', function () {
        var input, filter, table, tr, td, i, txtValue, found;
        input = document.getElementById('searchInput');
        filter = input.value.toUpperCase();
        table = document.getElementById('data-table');
        tr = table.getElementsByTagName('tr');
        found = false; // Initialize found as false

        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName('td');
            if (td.length > 0) { // Ensure td elements exist
                let match = false;
                for (let j = 0; j < td.length; j++) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        match = true;
                        break;
                    }
                }
                tr[i].style.display = match ? "" : "none";
                found = found || match;
            }
        }
        // Display 'không tìm thấy nội dung' if nothing is found
        var noResultsRow = document.getElementById('noresults');
        noResultsRow.style.display = found ? "none" : "table-row";
    });

//Add Modal JS
    function openAddReportModal() {
        console.log(bootstrap.Modal);
        var modal = new bootstrap.Modal(document.getElementById('AddReportModal'));
        modal.show();
    }

//Delete Modal JS
    function openDeleteModal(reportId) {
        // Cập nhật giá trị ReportId vào hidden field của form
        document.getElementById('DeleteReportId').value = reportId;

        // Mở modal sử dụng Bootstrap 5
        const modal = new bootstrap.Modal(document.getElementById('DeleteReportModal'));
        modal.show();
    }

// Open modal Submit Report
    function openSubmitSemesterReport(reportId) {
        document.getElementById('SubmitReportId').value = reportId;
        // Show the modal
        var modal = new bootstrap.Modal(document.getElementById('SubmitReportModal'));
        modal.show();
    }
// Open modal Browse Report
function openBrowseSemesterReport(reportId) {
    document.getElementById('BrowseReportId').value = reportId;
    // Show the modal
    var modal = new bootstrap.Modal(document.getElementById('BrowseReportModal'));
    modal.show();
}
// Edit Report Modal JS
    function openEditSemesterReport(reportId, periodId, reportType, classId) {
        document.getElementById('EditReportId').value = reportId;
        document.getElementById('EditPeriodId').value = periodId;
        document.getElementById('EditReportType').value = reportType;
        document.getElementById('EditClassId').value = classId;
        // Show the modal
        var modal = new bootstrap.Modal(document.getElementById('EditSemesterReportModal'));
        modal.show();
    }

//File Uploading JS
    function showFileList(inputId) {
        // Get the file input element using its unique ID
        const inputField = document.getElementById(inputId);

        // Get the files from the input field
        const files = inputField.files;

        // Get the file list container in the modal
        const fileListContainer = document.getElementById('fileList');

        // Clear any previous file list items
        fileListContainer.innerHTML = '';

        // Check if files are uploaded
        if (files.length === 0) {
            fileListContainer.innerHTML = '<li class="list-group-item">Chưa có file nào được tải lên</li>';
            return;
        }

        // Iterate over the files and add them to the modal
        for (let i = 0; i < files.length; i++) {
            const listItem = document.createElement('li');
            listItem.classList.add('list-group-item');

            // Create the text and delete button
            const fileName = document.createElement('span');
            fileName.textContent = files[i].name;
            fileName.style.marginRight = '10px';

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'X';
            deleteBtn.classList.add('btn', 'btn-danger', 'btn-sm');
            deleteBtn.onclick = function () {
                removeFile(inputField, i);
                listItem.remove(); // Remove the file list item from the modal
            };

            // Append the file name and delete button
            listItem.appendChild(fileName);
            listItem.appendChild(deleteBtn);

            // Append the list item to the modal
            fileListContainer.appendChild(listItem);
        }
    }

    function removeFile(inputField, fileIndex) {
        // Create a new FileList excluding the file at fileIndex
        const fileList = Array.from(inputField.files);
        fileList.splice(fileIndex, 1); // Remove the file from the list

        // Update the file input field with the new FileList
        const newFileList = new DataTransfer();
        fileList.forEach(file => newFileList.items.add(file));
        inputField.files = newFileList.files; // Update the input's files
    }

//View Report Detail JS
    function openEditDetailModal(reportId) {
        var modal = document.getElementById("EditReportDetailModal");
        $(modal).modal('show');

        var idField = document.getElementById("DetailIds");
        idField.value = reportId;
        // Fetch the report details
        fetch(`/Categories/GetReportDetails?reportId=${reportId}`)
            .then(response => {
                // Check if the response is successful (status code 200)
                if (!response.ok) {
                    throw new Error(`Error: ${response.status} - ${response.statusText}`);
                }
                // Parse and return the JSON data from the response
                return response.json();
            })
            .then(data => {
                // Log the fetched JSON data into the console
                console.log("Fetched Report Details:", data);

                // Define the pattern for the IDs
                const idPattern = [
                    "1_1", "2_1", "3_1", "3_2", "4_1", "4_2",
                    "5_1", "5_2", "5_3", "6_1", "7_1", "8_1", "8_2"
                ];

                const selfAssessment = document.getElementById('EditselfAssessment');
                const selfRank = document.getElementById('Editranking');
                const facAssessment = document.getElementById('EditFaculityAssessment');
                const facRank = document.getElementById('EditFaculityranking');
                selfAssessment.textContent = data.assessmentData.selfAssessment;
                selfRank.value = data.assessmentData.selfRanking;
                facAssessment.textContent = data.assessmentData.facultyAssessment;
                facRank.value = data.assessmentData.facultyRanking;
                // Iterate over the fetched data and insert "howToExecuteReport" into the respective elements
                data.reportDetails.forEach((detail, index) => {
                    // Get the corresponding ID from the pattern list
                    const elementId = idPattern[index];

                    // Find the element with the generated ID
                    const element = document.getElementById(`EditHowToExecute${elementId}`);

                    const detailIdHolder = document.getElementById(`buttonForDetail${index}`);

                    if (element) {
                        // Insert the "howToExecuteReport" value into the element
                        element.textContent = detail.howToExecuteReport;
                        //Modify data field for button
                        detailIdHolder.setAttribute("data-detail-id", detail.detailReportlId);
                    } else {
                        console.warn(`Element with ID ${elementId} not found`);
                    }
                });
            })
            .catch(error => {
                // Log any errors that occur during the fetch request
                console.error("Error fetching report details:", error);
            });
    }

//File viewing in report detail:
    // Function to fetch and load the attachments when the button is clicked
    function fetchAttachmentsFromButton(button) {
        // Get the associated 'detail-id' from the button
        var detailId = $(button).attr('data-detail-id');
        var filesId = $(button).data('files');
        console.log(detailId);

        // Get the display element for the file list
        const display = document.getElementById('fileList');
        // Get the file input element by ID (filesId)
        var fileInput = document.getElementById(filesId);
        // Get the files selected in the file input
        var files = fileInput.files;

        // Perform the AJAX request to fetch attachments from the server
        $.ajax({
            url: '/Categories/GetReportAttachments',  // Your backend endpoint
            method: 'GET',
            data: { detailId: detailId },  // Send the detailId as a query parameter
            success: function (data) {
                // Clear the current list
                display.innerHTML = '';

                // Check if data contains files
                if (data && data.length > 0) {
                    // Loop through the data and create list items
                    data.forEach(file => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';

                        // Create a clickable file name for download
                        const fileLink = document.createElement('a');
                        fileLink.href = `/Categories/DownloadProof?proofId=${file.attachmentReportId}`; // Use the correct API endpoint
                        fileLink.target = "_blank";  // Open the file in a new tab
                        fileLink.textContent = file.fileNames;

                        // Create a remove button
                        const removeButton = document.createElement('button');
                        removeButton.className = 'btn btn-danger btn-sm';
                        removeButton.textContent = 'X';
                        removeButton.onclick = function () {
                            removeFileFromDb(listItem, file.attachmentReportId);
                        };

                        // Append the file name and remove button to the list item
                        listItem.appendChild(fileLink);
                        listItem.appendChild(removeButton);

                        // Append the list item to the file list
                        display.appendChild(listItem);
                    });
                } 

                if (files.length > 0) {
                    Array.from(files).forEach((file, index) => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';

                        // Create a clickable file name (display the file name)
                        const fileLink = document.createElement('a');
                        fileLink.href = "#";  // No download URL since it's just from input
                        fileLink.target = "_blank";  // Open the file in a new tab (though no URL for direct link)
                        fileLink.textContent = file.name;

                        // Create a remove button
                        const removeButton = document.createElement('button');
                        removeButton.className = 'btn btn-danger btn-sm';
                        removeButton.textContent = 'X';
                        removeButton.onclick = function () {
                            removeFileFromList(fileInput, index, listItem);  // Use the index provided by forEach
                        };

                        // Append the file name and remove button to the list item
                        listItem.appendChild(fileLink);
                        listItem.appendChild(removeButton);

                        // Append the list item to the file list
                        display.appendChild(listItem);
                    });
                }

                // Show the modal
                $('#fileListModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.error("Error fetching attachments:", error);
                alert("Failed to fetch attachments. Please try again.");
            }
        });
    }

    // Function to handle file removal from db
    function removeFileFromDb(listItem, proofId) {
        // Confirm removal
        if (confirm("Are you sure you want to remove this file?")) {
            // Send a delete request to the backend
            $.ajax({
                url: '/Categories/DeleteProof',  // Your backend endpoint for deleting files
                method: 'POST',
                data: { proofId: proofId },  // Send the proofId to identify the file
                success: function (response) {
                    if (response.success) {
                        // If successful, remove the file item from the list
                        listItem.remove();
                    } else {
                        alert('Failed to delete the file. Please try again.');
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error deleting file:", error);
                    alert("Failed to delete the file. Please try again.");
                }
            });
        }
    }

    // Function to handle file removal from upload field
    function removeFileFromList(fileInput, fileIndex, listItem) {
        // Create a new FileList excluding the file at fileIndex
        const fileList = Array.from(fileInput.files);
        fileList.splice(fileIndex, 1); // Remove the file from the list

        // Update the file input field with the new FileList
        const newFileList = new DataTransfer();
        fileList.forEach(file => newFileList.items.add(file));
        fileInput.files = newFileList.files; // Update the input's files

        // Remove the <li> item from the display list
        listItem.remove();
    }

//Helper function to clear file list display
    document.getElementById('fileListModal').addEventListener('hide.bs.modal', function () {
        document.getElementById('fileList').innerHTML = ''; // Clear the inner HTML of the file list
    });

</script>